<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momas AI Chat Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/modal@2.6.2/dist/index.iife.js"></script>
    <style>
        body { background-color: #fafafa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid #eee;
            transition: all 0.2s;
            text-align: left;
        }
        .wallet-option:hover {
            border-color: #000;
            background: #fafafa;
            transform: translateX(4px);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Chat UI giá»¯ nguyÃªn nhÆ° cÅ© -->
    <div class="w-full max-w-2xl bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <div class="bg-black p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold">Momas AI</h1>
                <p class="text-xs text-gray-400">Powered by Gemini 2.5 Flash</p>
            </div>
            <div class="flex items-center gap-3">
                <div id="wallet-status" class="hidden items-center gap-2 bg-zinc-800 px-3 py-1.5 rounded-2xl">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span id="wallet-address" class="text-sm font-mono"></span>
                </div>
                <button id="connect-btn" onclick="connectWallet()" class="bg-white text-black px-5 py-2 rounded-2xl font-medium hover:bg-zinc-200 transition-colors">
                    Connect Wallet
                </button>
            </div>
        </div>

        <div id="chat-history" class="h-[450px] overflow-y-auto p-6 space-y-4 bg-gray-50/50">
            <div class="flex justify-start">
                <div class="bg-white border border-gray-200 text-gray-800 p-4 rounded-2xl rounded-tl-none shadow-sm max-w-[85%]">
                    Hey bro! I've updated to the latest version. Do you need any help?
                </div>
            </div>
        </div>

        <div class="p-6 bg-white border-t border-gray-100">
            <div class="relative flex items-center">
                <input type="text" id="user-input" onkeypress="if(event.key === 'Enter') askGemini()" 
                       class="w-full pb-3 pt-3 pl-4 pr-16 bg-gray-100 border-none rounded-2xl focus:ring-2 focus:ring-black outline-none transition-all" 
                       placeholder="Ask anything...">
                <button onclick="askGemini()" id="send-btn" class="absolute right-2 bg-black text-white p-2 rounded-xl hover:scale-105 active:scale-95 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Connect Modal -->
    <div id="connect-modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl w-full max-w-[380px] overflow-hidden shadow-xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold">Connect a Wallet</h2>
                    <button onclick="closeConnectModal()" class="text-3xl text-gray-400 hover:text-black">Ã—</button>
                </div>
                <div class="space-y-2">
                    <button onclick="connectWith('metamask')" class="wallet-option">
                        <div class="w-11 h-11 bg-[#F6851B] rounded-2xl flex items-center justify-center text-white text-3xl">ðŸ¦Š</div>
                        <div><div class="font-medium">MetaMask</div><div class="text-xs text-gray-500">Browser & mobile</div></div>
                    </button>
                    <button onclick="connectWith('okx')" class="wallet-option">
                        <div class="w-11 h-11 bg-black rounded-2xl flex items-center justify-center text-white font-bold text-2xl">OKX</div>
                        <div><div class="font-medium">OKX Wallet</div><div class="text-xs text-gray-500">Popular in Asia</div></div>
                    </button>
                    <button onclick="connectWith('binance')" class="wallet-option">
                        <div class="w-11 h-11 bg-yellow-500 rounded-2xl flex items-center justify-center text-3xl">BNB</div>
                        <div><div class="font-medium">Binance Wallet</div><div class="text-xs text-gray-500">Official Binance</div></div>
                    </button>
                    <button onclick="connectWith('walletconnect')" class="wallet-option">
                        <div class="w-11 h-11 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-3xl">ðŸ”—</div>
                        <div><div class="font-medium">WalletConnect</div><div class="text-xs text-gray-500">Scan with mobile</div></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyBne9FrQjLIZPOf78fjHwame5hi8Y7-Nyw";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
        const WALLET_CONNECT_PROJECT_ID = "62f3d5e881a6c16cdcdde5f4a1d41389";

        let userAddress = null;

        function connectWallet() {
            document.getElementById('connect-modal').classList.remove('hidden');
        }

        function closeConnectModal() {
            document.getElementById('connect-modal').classList.add('hidden');
        }

        async function connectWith(walletType) {
            closeConnectModal();

            if (walletType === 'metamask') {
                if (!window.ethereum) {
                    window.open('https://metamask.io/download/', '_blank');
                    return;
                }
                await connectMetaMask();
            }
            else if (walletType === 'okx') {
                if (!window.okxwallet) {
                    window.open('https://www.okx.com/web3', '_blank');
                    return;
                }
                await connectOKX();
            }
            else if (walletType === 'binance') {
                if (!window.BinanceChain) {
                    window.open('https://www.binance.com/en/wallet', '_blank');
                    return;
                }
                await connectBinance();
            }
            else if (walletType === 'walletconnect') {
                await connectWalletConnect();
            }
        }

        async function connectMetaMask() {
            const btn = document.getElementById('connect-btn');
            const status = document.getElementById('wallet-status');
            const addressEl = document.getElementById('wallet-address');

            try {
                btn.disabled = true;
                btn.textContent = "Connecting...";

                const provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                
                userAddress = accounts[0];
                const short = userAddress.substring(0,6) + "..." + userAddress.substring(userAddress.length-4);
                addressEl.textContent = short;

                status.classList.remove('hidden');
                status.classList.add('flex');

                btn.textContent = "Disconnect";
                btn.onclick = disconnectWallet;

                document.getElementById('user-input').disabled = false;
                document.getElementById('send-btn').disabled = false;
            } catch (err) {
                alert("MetaMask connect failed: " + err.message);
                btn.textContent = "Connect Wallet";
                btn.disabled = false;
            }
        }

        async function connectOKX() {
            const btn = document.getElementById('connect-btn');
            try {
                btn.disabled = true;
                btn.textContent = "Connecting...";

                const provider = new ethers.BrowserProvider(window.okxwallet);
                const accounts = await provider.send("eth_requestAccounts", []);
                
                userAddress = accounts[0];
                const short = userAddress.substring(0,6) + "..." + userAddress.substring(userAddress.length-4);
                document.getElementById('wallet-address').textContent = short;

                document.getElementById('wallet-status').classList.remove('hidden');
                document.getElementById('wallet-status').classList.add('flex');

                btn.textContent = "Disconnect";
                btn.onclick = disconnectWallet;

                document.getElementById('user-input').disabled = false;
                document.getElementById('send-btn').disabled = false;
            } catch (err) {
                alert("OKX connect failed: " + err.message);
                btn.textContent = "Connect Wallet";
                btn.disabled = false;
            }
        }

        async function connectBinance() {
            const btn = document.getElementById('connect-btn');
            try {
                btn.disabled = true;
                btn.textContent = "Connecting...";

                const provider = new ethers.BrowserProvider(window.BinanceChain);
                const accounts = await provider.send("eth_requestAccounts", []);
                
                userAddress = accounts[0];
                const short = userAddress.substring(0,6) + "..." + userAddress.substring(userAddress.length-4);
                document.getElementById('wallet-address').textContent = short;

                document.getElementById('wallet-status').classList.remove('hidden');
                document.getElementById('wallet-status').classList.add('flex');

                btn.textContent = "Disconnect";
                btn.onclick = disconnectWallet;

                document.getElementById('user-input').disabled = false;
                document.getElementById('send-btn').disabled = false;
            } catch (err) {
                alert("Binance Wallet connect failed: " + err.message);
                btn.textContent = "Connect Wallet";
                btn.disabled = false;
            }
        }

        async function connectWalletConnect() {
            const btn = document.getElementById('connect-btn');
            btn.disabled = true;
            btn.textContent = "Opening QR...";

            try {
                const wcModal = new window.WalletConnectModal({
                    projectId: WALLET_CONNECT_PROJECT_ID,
                    themeMode: "light",
                    chains: [1]
                });

                const { uri, approval } = await wcModal.open();
                const session = await approval();
                const provider = new ethers.BrowserProvider(session.provider);
                const accounts = await provider.send("eth_requestAccounts", []);
                
                userAddress = accounts[0];
                const short = userAddress.substring(0,6) + "..." + userAddress.substring(userAddress.length-4);
                document.getElementById('wallet-address').textContent = short;

                document.getElementById('wallet-status').classList.remove('hidden');
                document.getElementById('wallet-status').classList.add('flex');

                btn.textContent = "Disconnect";
                btn.onclick = disconnectWallet;

                document.getElementById('user-input').disabled = false;
                document.getElementById('send-btn').disabled = false;
            } catch (err) {
                console.error(err);
                alert("WalletConnect failed: " + (err.message || "User rejected"));
                btn.textContent = "Connect Wallet";
                btn.disabled = false;
            }
        }

        function disconnectWallet() {
            userAddress = null;
            const status = document.getElementById('wallet-status');
            const btn = document.getElementById('connect-btn');
            
            status.classList.add('hidden');
            status.classList.remove('flex');
            
            btn.textContent = "Connect Wallet";
            btn.onclick = connectWallet;
            
            document.getElementById('user-input').disabled = true;
            document.getElementById('send-btn').disabled = true;
        }

        // askGemini function (giá»¯ nguyÃªn nhÆ° trÆ°á»›c)
        window.askGemini = async function() {
            const inputField = document.getElementById('user-input');
            const history = document.getElementById('chat-history');
            const btn = document.getElementById('send-btn');
            const prompt = inputField.value.trim();

            if (!prompt) return;

            history.innerHTML += `<div class="flex justify-end"><div class="bg-black text-white p-4 rounded-2xl rounded-tr-none shadow-md max-w-[85%]">${prompt}</div></div>`;
            
            inputField.value = "";
            history.scrollTop = history.scrollHeight;
            btn.disabled = true;

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error ? data.error.message : "Model error");

                const text = data.candidates[0].content.parts[0].text;
                history.innerHTML += `<div class="flex justify-start"><div class="bg-white border border-gray-200 text-gray-800 p-4 rounded-2xl rounded-tl-none shadow-sm max-w-[85%]">${text.replace(/\n/g, '<br>')}</div></div>`;
            } catch (error) {
                history.innerHTML += `<div class="text-red-500 text-center text-xs py-2">Lá»—i: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                history.scrollTop = history.scrollHeight;
            }
        };

        window.onload = function() {
            document.getElementById('user-input').disabled = true;
            document.getElementById('send-btn').disabled = true;
        };
    </script>
</body>
</html>
